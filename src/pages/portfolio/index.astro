---
import Base from "@/layouts/Base.astro";
import PortfolioBrowser from "@/components/PortfolioBrowser.astro";
import { getCollection } from "astro:content";
import { slugify } from "@/utils/slugify";

// use the SAME ids you used in the working detail pages:
const cs = await getCollection("caseStudies");   // or "case-studies" if that’s your config
const sw = await getCollection("systemWins");    // or "system-wins"
const wr = await getCollection("writing");

const toItem = (type: "Case Study" | "System Win" | "Writing") => (e:any) => ({
  slug: slugify(e.slug ?? e.id ?? e.data.title),
  title: e.data.title,
  summary: e.data.summary,
  type,
  year: e.data.year,
  streams: e.data.streams ?? [],
  industries: e.data.industries ?? [],
  projectTypes: e.data.projectTypes ?? [],
  tags: e.data.tags ?? [],
  thumbnail: e.data.thumbnail
});

const items = [...cs.map(toItem("Case Study")), ...sw.map(toItem("System Win")), ...wr.map(toItem("Writing"))]
  .sort((a,b)=>b.year-a.year);

const url = new URL(Astro.request.url).toString();
---
<Base title="Portfolio — SMooks" description="Filterable, searchable portfolio: case studies, systems wins, and writing." canonical={url}>
  <header class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 py-8">
    <h1 class="text-3xl font-bold">Portfolio</h1>
    <p class="mt-2 text-gray-600">Search and filter by type, transformation streams, industry, and project type.</p>
  </header>
  <PortfolioBrowser items={items} />
</Base>
